"use strict";!function(){function e(e){function t(e){"touchstart"===e.type&&l.removeEventListener("mousedown",t),d.playing?d.pause():d.play()}function n(){u.classList.toggle("is-playing",d.playing),d.playing&&s()}function o(e,t){var n="rotate("+t+"deg)";e.style.webkitTransform=n,e.style.transform=n}function a(e){if(v){var t=360*e;o(v,Math.min(t,180)),o(m,Math.max(t-180,0)),p()}else c?p(c.getFrequencies(!1)):p()}function s(){u.classList.contains("is-active")&&d.data&&a(d.progress)}function i(){p=v?r.utils.waveformer({shape:"circular",style:"fill",sound:d,canvas:f,innerRadius:180,lineWidth:1.5,color:function(e,t){return e/t<d.progress?"#bbcccc":"#dddddd"}}):c?r.utils.waveformer({shape:"linear",style:"fill",lineWidth:2,canvas:f,color:function(e,t){var n=e/t*360;return"hsl("+n+", 100%, 50%)"},transform:function(e){return e/256}}):r.utils.waveformer({sound:d,shape:"linear",style:"fill",lineWidth:2,canvas:f,color:function(e,t){return e/t<d.progress?"#bbcccc":"#dddddd"}}),a(0),l.addEventListener("touchstart",t),l.addEventListener("mousedown",t)}var d=e.sound,u=e.el,c=e.analyser,l=u.querySelector("[data-inner]"),v=u.querySelector("[data-progressA]"),m=u.querySelector("[data-progressB]"),f=u.querySelector("canvas"),p=void 0;return d.on("ready",i).on("ended",n).on("play",n).on("pause",n),s.el=u,s.destroy=function(e){e&&d.destroy(),d.off(),l.removeEventListener("touchstart",t),l.removeEventListener("mousedown",t),u.classList.remove("is-active")},d.data&&i(),s}function t(e,t){function n(e){e?(l.classList.remove("Control-mark--cross"),l.classList.add("Control-mark--tick")):(l.classList.remove("Control-mark--tick"),l.classList.add("Control-mark--cross")),r(e?i:d)}function o(e){"touchstart"===e.type&&c.removeEventListener("mousedown",o),u=!u,n(u),t&&t(u)}function r(e){v.value=e}function a(){c.removeEventListener("mousedown",o),c.removeEventListener("touchstart",o)}var s=e.name||"",i=e.labelOn||"on",d=e.labelOff||"off",u=!!e.value,c=document.createElement("div");c.innerHTML='\n        <div class="Control" data-toggle>\n          <h3 class="Control-name" data-name>'+s+'</h3>\n          <div class="Control-inner">\n            <div class="Control-circle">\n              <div class="Control-mark Control-mark--cross" data-icon></div>\n            </div>\n          </div>\n          <output class="Control-output" data-output></output>\n        </div>\n        ',e.el.appendChild(c);var l=c.querySelector("[data-icon]"),v=c.querySelector("[data-output]");return c.addEventListener("mousedown",o),c.addEventListener("touchstart",o),n(u),{setLabel:r,destroy:a}}function n(e,t){function n(e){"touchstart"===e.type&&a.removeEventListener("mousedown",n),t&&t()}function o(){a.removeEventListener("mousedown",n),a.removeEventListener("touchstart",n)}var r=e.name||"",a=document.createElement("div");return a.innerHTML='\n        <div class="Control" data-trigger>\n            <h3 class="Control-name" data-name>'+r+'</h3>\n            <div class="Control-inner">\n                <div class="Control-circle">\n                    <div class="Control-mark Control-mark--play" data-icon></div>\n                </div>\n            </div>\n            <output class="Control-output" data-output>&nbsp;</output>\n        </div>\n        ',e.el.appendChild(a),a.addEventListener("mousedown",n),a.addEventListener("touchstart",n),{destroy:o}}function o(e,t){function n(e){e.preventDefault(),"touchstart"===e.type?(f.removeEventListener("mousedown",n),document.body.addEventListener("touchmove",r),document.body.addEventListener("touchend",o)):(document.body.addEventListener("mousemove",r),document.body.addEventListener("mouseup",o)),r(e)}function o(e){e.preventDefault(),document.body.removeEventListener("mousemove",r),document.body.removeEventListener("touchmove",r),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("touchend",o)}function r(e){e.preventDefault(),e.touches&&(e=e.touches[0]);var n=f.getBoundingClientRect(),o=n.left+n.width/2,r=n.top+n.height/2,a=e.clientX,s=e.clientY,L=y.distance(o,r,a,s);if(L<100){for(var E=y.angle(o,r,a,s),C=y.degrees(E)+90;C<0;)C+=360;for(;C>360;)C-=360;m=C-v,v>270&&C<90&&(m+=360),v<90&&C>270&&(m-=360),m/=360,m*=Math.min(c,1e3),l+=m,v=C,l=y.clamp(l,d,u);var g="rotate("+v.toFixed(1)+"deg)";p.style.webkitTransform=g,p.style.transform=g,h&&(h.value=l.toFixed(i)),t&&t(l,m)}}function a(){document.body.removeEventListener("mousemove",r),document.body.removeEventListener("touchmove",r),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("touchend",o),f.removeEventListener("mousedown",n),f.removeEventListener("touchstart",n)}var s=e.name||"",i="number"==typeof e.places?e.places:4,d=e.min||0,u=e.max||0,c=u-d,l=e.value||0,v=0,m=0,f=document.createElement("div");f.innerHTML='\n        <div class="Control" data-control>\n            <h3 class="Control-name" data-name>'+s+'</h3>\n            <div class="Control-inner">\n                <div class="Control-circle" data-wheel>\n                    <div class="Control-mark Control-mark--line"></div>\n                </div>\n            </div>\n            <div class="Control-inner">\n                <div class="Control-bound" data-min>'+d.toFixed(i)+'</div>\n                <output class="Control-output" data-output>'+l.toFixed(i)+'</output>\n                <div class="Control-bound" data-max>'+u.toFixed(i)+"</div>\n            </div>\n        </div>\n        ",e.el.appendChild(f);var p=f.querySelector("[data-wheel]"),h=f.querySelector("[data-output]"),y={DEG:180/Math.PI,angle:function(e,t,n,o){var r=n-e,a=o-t;return Math.atan2(a,r)},clamp:function(e,t,n){if(t>n){var o=t;t=n,n=o}return e<t?d:e>n?n:e},degrees:function(e){return e*this.DEG},distance:function(e,t,n,o){var r=y.distanceSQ(e,t,n,o);return Math.sqrt(r)},distanceSQ:function(e,t,n,o){var r=e-n,a=t-o;return r*r+a*a}};return f.addEventListener("mousedown",n),f.addEventListener("touchstart",n),{destroy:a}}var r=window.sono;window.ui={createPlayer:e,createControl:o,createToggle:t,createTrigger:n}}();
